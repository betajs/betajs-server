<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>BetaJS Base Stores</title>
		<script src="../assets/jquery-1.9.1.min.js"></script>
		<script src="../assets/beta.js"></script>
		<script src="../assets/beta-browser.js"></script>
		<script src="../assets/beta-data.js"></script>
	</head>
	<body>
		<div>
			<input id="query" placeholder="Query" value="{}" />
			<input id="query_params" placeholder="Params" value='{"limit": 3}' />
			<button id="execute">Execute</button>
		</div>
		<hr >
		<div id="list">
		</div>
		<div>
			<input id="first" />
			<input id="last" />
			<button id="add">Add</button>
		</div>
		<script>
			// Stores: insert, remove, update, get, query
			//var store = new BetaJS.Stores.MemoryStore(); // stores everything temporarily in the browser's memory
			//var store = new BetaJS.Stores.LocalStore({prefix: "test12345"});
			//var store = new BetaJS.Stores.RemoteStore("http://localhost:3000/users", new BetaJS.Browser.JQueryAjax());
			var store = new BetaJS.Stores.QueryGetParamsRemoteStore("http://localhost:3000/users", new BetaJS.Browser.JQueryAjax(),
			            {"limit": "limit", "skip": "skip", "sort": "sort", "query": "query"});
			//store = new BetaJS.Stores.CachedStore(store);
			var add_default_data = false;
			
			$("#execute").on("click", execute_query);
			
			if (add_default_data) {
				store.insert({"first": "Max", "last": "Master"});
				store.insert({"first": "Martin", "last": "Fischer"});
				store.insert({"first": "Julia", "last": "Lustig"});
				store.insert({"first": "Ophelia", "last": "Zensch"});
				store.insert({"first": "Julia", "last": "Janitzer"});
			}
			
			function remove_item(id) {
				store.remove(id);
			}
			
			function execute_query() {
				$("#list").html("");
				var query = JSON.parse($("#query").val());
				var query_params = JSON.parse($("#query_params").val());
				// Synchronous
				/*
				var iterator = store.query(query, query_params);
				while (iterator.hasNext()) {
					var item = iterator.next();
					$("#list").append("<p>" + JSON.stringify(item) +
					                        "<button onclick='remove_item(\"" + item.id + "\")'>Remove</button>" + "</p>");
				}
				*/
				// Asynchronous
				store.query(query, query_params, {
					success: function (iterator) {
						while (iterator.hasNext()) {
							var item = iterator.next();
							$("#list").append("<p>" + JSON.stringify(item) +
							                        "<button onclick='remove_item(\"" + item.id + "\")'>Remove</button>" + "</p>");
						}
					}
				});
				
			}
			
			execute_query();

			$("#add").on("click", function () {
				store.insert({"first": $("#first").val(), "last": $("#last").val()});
				$("#first").val("");
				$("#last").val("");
			});
						
		</script>
	</body>
</html>